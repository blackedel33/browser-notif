{"version":3,"sources":["BrowserNotif.js"],"names":["global","factory","define","amd","exports","mod","BrowserNotif","this","_classCallCheck","instance","Constructor","TypeError","Object","defineProperty","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","options","notifOptions","data","timeout","Permission","Default","Granted","Denied","_setOptions","isSupported","console","warn","option","indexOf","navigator","serviceWorker","register","serviceWorkerPath","then","serviceWorkerRegistration","log","catch","e","callback","_this","ready","registration","tag","Math","random","toString","substr","keys","JSON","stringify","showNotification","title","error","_this2","getNotifications","notifications","body","_this3","_validateTitle","Notification","permission","_notify","requestPermission","alert","Error","trim","_this4","isMobile","_registerServiceWorker","_showNotifServiceWorker","_getNotifServiceWorker","notification","close","_closeNotification","setTimeout","bind","_this5","onclick","clickOnServiceWorker","_this6","onerror","mobileExp","RegExp","test","userAgent","Win","_this7","default","window"],"mappings":"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","file":"BrowserNotif.min.js","sourcesContent":["(function (global, factory) {\n    if (typeof define === \"function\" && define.amd) {\n        define(['exports'], factory);\n    } else if (typeof exports !== \"undefined\") {\n        factory(exports);\n    } else {\n        var mod = {\n            exports: {}\n        };\n        factory(mod.exports);\n        global.BrowserNotif = mod.exports;\n    }\n})(this, function (exports) {\n    'use strict';\n\n    Object.defineProperty(exports, \"__esModule\", {\n        value: true\n    });\n\n    var _extends = Object.assign || function (target) {\n        for (var i = 1; i < arguments.length; i++) {\n            var source = arguments[i];\n\n            for (var key in source) {\n                if (Object.prototype.hasOwnProperty.call(source, key)) {\n                    target[key] = source[key];\n                }\n            }\n        }\n\n        return target;\n    };\n\n    function _classCallCheck(instance, Constructor) {\n        if (!(instance instanceof Constructor)) {\n            throw new TypeError(\"Cannot call a class as a function\");\n        }\n    }\n\n    var _createClass = function () {\n        function defineProperties(target, props) {\n            for (var i = 0; i < props.length; i++) {\n                var descriptor = props[i];\n                descriptor.enumerable = descriptor.enumerable || false;\n                descriptor.configurable = true;\n                if (\"value\" in descriptor) descriptor.writable = true;\n                Object.defineProperty(target, descriptor.key, descriptor);\n            }\n        }\n\n        return function (Constructor, protoProps, staticProps) {\n            if (protoProps) defineProperties(Constructor.prototype, protoProps);\n            if (staticProps) defineProperties(Constructor, staticProps);\n            return Constructor;\n        };\n    }();\n\n    var BrowserNotif = function () {\n        /**\n         * BrowserNotif constructor\n         * @param  {BrowserNotifOptions} options Optional options in object literal form\n         * e.g {icon: 'image.png', timeout: 10}\n         */\n        function BrowserNotif(options) {\n            _classCallCheck(this, BrowserNotif);\n\n            /**\n             * BrowserNotif configuration\n             * @type {BrowserNotifOptions}\n             */\n            this.options = {};\n            /**\n             * Notification Options\n             * @type {NotificationOptions}\n             */\n            this.notifOptions = {};\n            /**\n             * Arbitrary data\n             * @type {Data}\n             */\n            this.data = {};\n            /**\n             * How long notification will appear in second. Set to 0 to make always visible\n             * @type {number}\n             */\n            this.timeout = 0;\n            /**\n             * Permission Type\n             * @type {PermissionInterface}\n             */\n            this.Permission = {\n                Default: 'default',\n                Granted: 'granted',\n                Denied: 'denied'\n            };\n            if (options) {\n                _extends(this.options, options);\n            }\n            this._setOptions(this.options);\n            if (options.timeout) {\n                this.timeout = options.timeout;\n            }\n            if (!BrowserNotif.isSupported()) {\n                console.warn('This browser does not support system notifications');\n            }\n        }\n        /**\n         * Check is browser support for system notification\n         * @return {boolean}\n         */\n\n\n        _createClass(BrowserNotif, [{\n            key: '_setOptions',\n            value: function _setOptions(options) {\n                for (var option in options) {\n                    if (['timeout', 'serviceWorkerPath'].indexOf(option) == -1) {\n                        this.notifOptions[option] = options[option];\n                    }\n                }\n            }\n        }, {\n            key: '_registerServiceWorker',\n            value: function _registerServiceWorker() {\n                if ('serviceWorker' in navigator) {\n                    navigator.serviceWorker.register(this.options.serviceWorkerPath || 'sw.js').then(function (serviceWorkerRegistration) {\n                        console.log('Service Worker is ready :', serviceWorkerRegistration);\n                    }).catch(function (e) {\n                        return console.warn('BrowserNotif: ', e);\n                    });\n                }\n            }\n        }, {\n            key: '_showNotifServiceWorker',\n            value: function _showNotifServiceWorker(callback) {\n                var _this = this;\n\n                if ('serviceWorker' in navigator) {\n                    navigator.serviceWorker.ready.then(function (registration) {\n                        if (!_this.notifOptions.tag) {\n                            _this.notifOptions.tag = 'browserNotif_' + Math.random().toString().substr(3, 10);\n                        }\n                        if (Object.keys(_this.data).length > 0) {\n                            _this.notifOptions.data = JSON.stringify(_this.data);\n                        }\n                        registration.showNotification(_this.title, _this.notifOptions).then(function () {\n                            callback.call(_this);\n                        });\n                    }).catch(function (e) {\n                        return console.error('BrowserNotif: ', e);\n                    });\n                }\n            }\n        }, {\n            key: '_getNotifServiceWorker',\n            value: function _getNotifServiceWorker(callback) {\n                var _this2 = this;\n\n                if ('serviceWorker' in navigator) {\n                    navigator.serviceWorker.ready.then(function (registration) {\n                        registration.getNotifications({ tag: _this2.notifOptions.tag }).then(function (notifications) {\n                            if (notifications.length > 0) {\n                                callback.call(_this2, notifications[0]);\n                            }\n                        });\n                    }).catch(function (e) {\n                        return console.error('BrowserNotif: ', e);\n                    });\n                }\n            }\n        }, {\n            key: 'notify',\n            value: function notify(title, body, callback) {\n                var _this3 = this;\n\n                if (!BrowserNotif.isSupported()) {\n                    alert(title + '\\n\\n' + body);\n                    return this;\n                }\n                this._validateTitle(title);\n                this.title = title;\n                this.notifOptions.body = body;\n                if (this.Permission.Granted === Notification.permission) {\n                    this._notify(callback);\n                } else if (this.Permission.Denied !== Notification.permission) {\n                    BrowserNotif.requestPermission(function (permission) {\n                        if (_this3.Permission.Granted === permission) {\n                            _this3._notify(callback);\n                        }\n                    });\n                } else {\n                    console.warn('User denied the notification permission');\n                }\n                return this;\n            }\n        }, {\n            key: '_validateTitle',\n            value: function _validateTitle(title) {\n                if (typeof title != 'string') {\n                    throw new Error('BrowserNotif: Title of notification must be a string');\n                } else if (title.trim() == '') {\n                    throw new Error('BrowserNotif: Title of notification could not be empty');\n                }\n            }\n        }, {\n            key: '_notify',\n            value: function _notify(callback) {\n                var _this4 = this;\n\n                if (this.isMobile()) {\n                    this._registerServiceWorker();\n                    this._showNotifServiceWorker(function () {\n                        _this4._getNotifServiceWorker(function (notification) {\n                            _this4.notification = notification;\n                            if (typeof callback === 'function') {\n                                callback.call(_this4, _this4.notification);\n                            }\n                        });\n                    });\n                } else {\n                    if (this.notification instanceof Notification) {\n                        this.notification.close();\n                    }\n                    this.notification = new Notification(this.title, this.notifOptions);\n                    this._closeNotification();\n                    if (typeof callback === 'function') {\n                        callback.call(this, this.notification);\n                    }\n                }\n            }\n        }, {\n            key: '_closeNotification',\n            value: function _closeNotification() {\n                if (this.timeout > 0 && this.notification instanceof Notification) {\n                    setTimeout(this.notification.close.bind(this.notification), this.timeout * 1e3);\n                }\n            }\n        }, {\n            key: 'click',\n            value: function click(callback) {\n                var _this5 = this;\n\n                if (typeof callback === 'function' && this.notification instanceof Notification) {\n                    this.notification.onclick = function () {\n                        _this5.notification.close();\n                        callback.call(_this5);\n                    };\n                }\n                return this;\n            }\n        }, {\n            key: 'clickOnServiceWorker',\n            value: function clickOnServiceWorker(callback) {\n                if (typeof callback === 'function') {\n                    this.data.clickOnServiceWorker = callback.toString();\n                }\n                return this;\n            }\n        }, {\n            key: 'close',\n            value: function close() {\n                if (this.notification instanceof Notification) {\n                    this.notification.close();\n                }\n            }\n        }, {\n            key: 'error',\n            value: function error(callback) {\n                var _this6 = this;\n\n                if (typeof callback === 'function' && this.notification instanceof Notification) {\n                    this.notification.onerror = function () {\n                        callback.call(_this6);\n                    };\n                }\n                return this;\n            }\n        }, {\n            key: 'isMobile',\n            value: function isMobile() {\n                var mobileExp = new RegExp('\\n                                    Android|webOS|iPhone|iPad|\\n                                    BlackBerry|Windows Phone|\\n                                    Opera Mini|IEMobile|Mobile', 'i');\n                return mobileExp.test(navigator.userAgent);\n            }\n        }], [{\n            key: 'isSupported',\n            value: function isSupported() {\n                if (!(\"Notification\" in BrowserNotif.Win)) {\n                    return false;\n                }\n                return true;\n            }\n        }, {\n            key: 'requestPermission',\n            value: function requestPermission(callback) {\n                var _this7 = this;\n\n                Notification.requestPermission(function (permission) {\n                    if (typeof callback === 'function') {\n                        callback.call(_this7, permission);\n                    }\n                });\n            }\n        }]);\n\n        return BrowserNotif;\n    }();\n\n    exports.default = BrowserNotif;\n\n    /**\n     * Readonly Win property\n     * @type {Window}\n     */\n    BrowserNotif.Win = window;\n});"]}